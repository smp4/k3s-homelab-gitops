
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="A basic, unavoidably opinionated, non-professional template for bootstrapping a K3S cluster at home.">
      
      
        <meta name="author" content="smp4">
      
      
      
        <link rel="prev" href="../">
      
      
        <link rel="next" href="../repo-contents/">
      
      
      <link rel="icon" href="../../assets/images/icons/favicon-32x32.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.26">
    
    
      
        <title>Installation - K3S Homelab Gitops Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.6543a935.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
   <link href="../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style> <script src="../../assets/javascripts/glightbox.min.js"></script></head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#installation" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="K3S Homelab Gitops Documentation" class="md-header__button md-logo" aria-label="K3S Homelab Gitops Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M7 2v2h1v14a4 4 0 0 0 4 4 4 4 0 0 0 4-4V4h1V2H7m4 14c-.6 0-1-.4-1-1s.4-1 1-1 1 .4 1 1-.4 1-1 1m2-4c-.6 0-1-.4-1-1s.4-1 1-1 1 .4 1 1-.4 1-1 1m1-5h-4V4h4v3Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            K3S Homelab Gitops Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Installation
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/smp4/k3s-homelab-gitops" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../" class="md-tabs__link">
          
  
    
  
  Getting Started

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../tutorials/" class="md-tabs__link">
          
  
    
  
  Tutorials

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../howtos/" class="md-tabs__link">
          
  
    
  
  How To's

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../explanations/" class="md-tabs__link">
          
  
    
  
  Explanations

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../reference/" class="md-tabs__link">
          
  
    
  
  Reference

        </a>
      </li>
    
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../development/" class="md-tabs__link">
        
  
    
  
  Development

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../about/" class="md-tabs__link">
          
  
    
  
  About

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          

            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="K3S Homelab Gitops Documentation" class="md-nav__button md-logo" aria-label="K3S Homelab Gitops Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M7 2v2h1v14a4 4 0 0 0 4 4 4 4 0 0 0 4-4V4h1V2H7m4 14c-.6 0-1-.4-1-1s.4-1 1-1 1 .4 1 1-.4 1-1 1m2-4c-.6 0-1-.4-1-1s.4-1 1-1 1 .4 1 1-.4 1-1 1m1-5h-4V4h4v3Z"/></svg>

    </a>
    K3S Homelab Gitops Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/smp4/k3s-homelab-gitops" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Getting Started
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2" id="__nav_2_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Getting Started
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Installation
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Installation
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#requirements" class="md-nav__link">
    <span class="md-ellipsis">
      Requirements
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Requirements">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ports-and-firewall-rules" class="md-nav__link">
    <span class="md-ellipsis">
      Ports and firewall rules
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#definitions" class="md-nav__link">
    <span class="md-ellipsis">
      Definitions
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#install-kubectl-argocd-cli-and-helm" class="md-nav__link">
    <span class="md-ellipsis">
      Install kubectl, ArgoCD CLI and Helm
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#initialise-gitops-repo" class="md-nav__link">
    <span class="md-ellipsis">
      Initialise GitOps repo
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Initialise GitOps repo">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pulling-updates-from-public-repo" class="md-nav__link">
    <span class="md-ellipsis">
      Pulling updates from public repo
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#install-ansible" class="md-nav__link">
    <span class="md-ellipsis">
      Install Ansible
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-ansible-inventory-and-values-files" class="md-nav__link">
    <span class="md-ellipsis">
      Create Ansible inventory and values files
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#generate-templated-manifests" class="md-nav__link">
    <span class="md-ellipsis">
      Generate templated manifests
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-local-bootstrap-secrets" class="md-nav__link">
    <span class="md-ellipsis">
      Create local bootstrap secrets
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#customise-the-cluster-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Customise the cluster configuration
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#helm-charts" class="md-nav__link">
    <span class="md-ellipsis">
      Helm Charts
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../repo-contents/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Repository Contents
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../tutorials/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Tutorials
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Tutorials
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/tutorial01/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tutorial part 1: Localhost with dev infrastructure
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/tutorial02/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tutorial part 2: Cluster with dev infrastructure
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/tutorial03/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tutorial part 3: Cluster with remote GitOps repo and stage infrastructure
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/tutorial04/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tutorial part 4: Cluster with remote GitOps repo and prod infrastructure
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/tutorial05/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tutorial part 5: Deploy new app to cluster with prod infrastructure
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../howtos/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    How To's
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4" id="__nav_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            How To's
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../howtos/kubectl/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kubectl
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../howtos/helm-kustomize/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Deploying Helm charts with ArgoCD and Kustomize
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../howtos/add-new-node/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Adding new nodes to the cluster
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../howtos/dynamic-environments/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Dynamic environment promotion
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../howtos/patching-argocd-cd.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    None
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../howtos/argocd-local-repo/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How-To: Notes on using local git repos with ArgoCD
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../explanations/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Explanations
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5" id="__nav_5_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Explanations
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../explanations/cluster-organisation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cluster organisation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../explanations/naming/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Naming conventions
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../reference/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Reference
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../development/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Development
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_8" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../about/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    About
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_8" id="__nav_8_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            About
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../about/CHANGELOG/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Changelog
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#requirements" class="md-nav__link">
    <span class="md-ellipsis">
      Requirements
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Requirements">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ports-and-firewall-rules" class="md-nav__link">
    <span class="md-ellipsis">
      Ports and firewall rules
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#definitions" class="md-nav__link">
    <span class="md-ellipsis">
      Definitions
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#install-kubectl-argocd-cli-and-helm" class="md-nav__link">
    <span class="md-ellipsis">
      Install kubectl, ArgoCD CLI and Helm
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#initialise-gitops-repo" class="md-nav__link">
    <span class="md-ellipsis">
      Initialise GitOps repo
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Initialise GitOps repo">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pulling-updates-from-public-repo" class="md-nav__link">
    <span class="md-ellipsis">
      Pulling updates from public repo
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#install-ansible" class="md-nav__link">
    <span class="md-ellipsis">
      Install Ansible
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-ansible-inventory-and-values-files" class="md-nav__link">
    <span class="md-ellipsis">
      Create Ansible inventory and values files
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#generate-templated-manifests" class="md-nav__link">
    <span class="md-ellipsis">
      Generate templated manifests
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-local-bootstrap-secrets" class="md-nav__link">
    <span class="md-ellipsis">
      Create local bootstrap secrets
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#customise-the-cluster-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Customise the cluster configuration
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#helm-charts" class="md-nav__link">
    <span class="md-ellipsis">
      Helm Charts
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          


          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
  
                  

  
    <a href="https://github.com/smp4/k3s-homelab-gitops/edit/main/docs/getting-started/installation.md" title="Edit this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4v-2m10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1 2.1 2.1Z"/></svg>
    </a>
  
  
    
      
    
    <a href="https://github.com/smp4/k3s-homelab-gitops/raw/main/docs/getting-started/installation.md" title="View source of this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4.5a8.15 8.15 0 0 1-1.23-2Z"/></svg>
    </a>
  


<h1 id="installation">Installation</h1>
<p>This page describes how to set up and install this Git repo on your local machine including getting the repo, installing Ansible, generating secrets and configuring the Ansible inventory and variables.</p>
<h2 id="requirements">Requirements</h2>
<ul>
<li>At least one machine to act as a server node.</li>
<li>Operating on a UNIX/ Linux operating system.</li>
<li>Minimum 1, ideally 3, machines or VM's to host the cluster nodes. </li>
<li>You must have <code>git</code> installed on at least your local workstation and the master server node.</li>
<li>You have set up SSH access to all cluster nodes, ideally password-less.</li>
<li>All cluster machines must have the relevant ports open on their firewalls. See below.</li>
</ul>
<p>Preferably:</p>
<ul>
<li>A domain name to use for the cluster, with DNS and Let's Encrypt set up to issue certificates. See <a href="https://technotim.live/posts/kube-traefik-cert-manager-le/">Techno Tim</a> for a guide.</li>
</ul>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>HA ArgoCD is installed by default, which requires at least three nodes. If your cluster has less than three nodes, the HA installation will still work, however you will have several ArgoCD pods stuck in the <code>Pending</code> state. This won't affect Argo but will chew up node resources. If using less than three nodes, change the ArgoCD <code>install.yaml</code> location specification in <code>bootstrap/base/kustomization.yaml</code>.</p>
</div>
<p>See <a href="https://docs.k3s.io/installation/requirements">k3s requirements docs</a>. When installing with multiple server nodes, the Ansible scripts will install K3S with the <code>--cluster-init</code> flag, which will set up an embedded <code>etcd</code> datastore. This requires further ports to be opened on the servers. Again, see the K3S docs.</p>
<p>Note, the following installation instructions will overwrite existing K3s installations on the hosts, and will overwrite the <code>.kube</code> directory on the hosts, if it exists.</p>
<h3 id="ports-and-firewall-rules">Ports and firewall rules</h3>
<p>For this cluster to work, make sure the following ports are open. For more information, see <a href="https://docs.k3s.io/installation/requirements#networking">K3s docs</a>.</p>
<table>
<thead>
<tr>
<th>Protocol</th>
<th>Port</th>
<th>Source</th>
<th>Destination</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>TCP</td>
<td>2379 - 2380</td>
<td>Servers</td>
<td>Servers</td>
<td>HA K3s with embedded etcd</td>
</tr>
<tr>
<td>TCP</td>
<td>6443</td>
<td>Agents and workstation</td>
<td>Servers</td>
<td>K3s supervisor and Kubernetes API Server</td>
</tr>
<tr>
<td>UDP</td>
<td>8472</td>
<td>All nodes</td>
<td>All nodes</td>
<td>Flannel VXLAN</td>
</tr>
<tr>
<td>TCP</td>
<td>10250</td>
<td>All nodes</td>
<td>All nodes</td>
<td>Kubelet metrics</td>
</tr>
<tr>
<td>TCP &amp; UDP</td>
<td>7946</td>
<td>All nodes and clients</td>
<td>Servers</td>
<td>MetalLB L2 mode traffic</td>
</tr>
<tr>
<td>TCP</td>
<td>7472</td>
<td>All nodes</td>
<td>All nodes</td>
<td>MetalLB metrics between nodes</td>
</tr>
<tr>
<td></td>
<td></td>
<td>10.42.0.0/16</td>
<td>any</td>
<td>K3s pods</td>
</tr>
<tr>
<td></td>
<td></td>
<td>10.43.0.0/16</td>
<td>any</td>
<td>K3s services</td>
</tr>
</tbody>
</table>
<p>Note also that if you are using an NFS network store as backup target, all nodes will need to have access to that target, as will the K3s pods (<code>10.42.0.0/16</code>).</p>
<p>Example NFS setup:</p>
<table>
<thead>
<tr>
<th>Protocol</th>
<th>Port</th>
<th>Source</th>
<th>Destination</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td>2049</td>
<td>10.42.0.0/16</td>
<td>NFS target host</td>
<td>K3s pods to NFS</td>
</tr>
<tr>
<td></td>
<td>111</td>
<td>10.43.0.0/16</td>
<td>NFS target host</td>
<td>K3s pods to NFS</td>
</tr>
<tr>
<td></td>
<td>2049</td>
<td>Servers</td>
<td>NFS target host</td>
<td>K3s server nodes running Longhorn to NFS</td>
</tr>
</tbody>
</table>
<h2 id="definitions">Definitions</h2>
<p>Before going further, some definitions are necessary.</p>
<ul>
<li><strong>Site</strong>: Refers to your infrastructure - the totality of the local (and possibly remote) machines and connecting network that will constitute your cluster and client machines connecting to your cluster. This term is relevant only within the scope of this repo.</li>
<li><strong>Local machine</strong>: Your local machine can take on any of the above roles. In fact, with K3s, it <em>can</em> simultaneously take all three if you wish. Also called your local host.</li>
<li><strong>Ansible controller workstation</strong>: The machine from which you will be executing any Ansible playbooks or Makefile commands from this repo. It's most likely your local machine and probably not a cluster node. It is not necessary that it isn't a cluster node, but you might find interesting (read: painful) edge cases if your local machine is also a cluster node.</li>
<li><strong>K3s/ Kubernetes server nodes</strong>: One or more machines running K3s as server nodes. The server nodes run together to form the cluster <strong>control plane</strong>. Given how voting amongst server nodes works, it makes sense for the control plane to consist of an odd number of server nodes only. A minimum of one server node is necessary to have a K3s cluster, in which case that node will operate as the server as well as execute workloads. A <strong>Highly Available (HA)</strong> control plane will exist only once there are three or more (5, 7, ...) server nodes.</li>
<li><strong>Master server node</strong>: The first machine in the <code>server</code> list of the Ansible inventory. This term is relevant only within the scope of this repo. While all K3s server nodes are created equal, the Ansible playbooks in this repo will provision and bootstrap the cluster infrastructure workload to the master server node first, before adding other server or agent nodes to the cluster. This is because the virtual IP provided by KubeVIP needs to be available before any other nodes can be added, and this will only happen once KubeVIP is deployed to the cluster.</li>
<li><strong>K3s agent nodes</strong>: One or more machines running K3s as an agent. These are worker nodes that execute workloads. A server node can also be a worker node. Any number of agent nodes can be added to the cluster, to increase the available resources and redundancy.</li>
</ul>
<p>All machines are assumed to be on the same private network.</p>
<h2 id="install-kubectl-argocd-cli-and-helm">Install kubectl, ArgoCD CLI and Helm</h2>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>You must use a kubectl version that is within one minor version difference of your cluster. For example, a v1.29 client can communicate with v1.28, v1.29, and v1.30 control planes. Using the latest compatible version of kubectl helps avoid unforeseen issues.</p>
</div>
<p>Install <code>kubectl</code> following the <a href="https://kubernetes.io/docs/tasks/tools/">docs</a>. <code>kustomize</code> <a href="https://kubernetes.io/docs/reference/kubectl/generated/kubectl_kustomize/">comes as part of</a> <code>kubectl</code>, albeit an earlier version sometimes. </p>
<p>Install <code>helm</code> following the <a href="https://helm.sh/docs/intro/install/">docs</a>.</p>
<p>Install ArgoCD CLI following the <a href="https://argo-cd.readthedocs.io/en/stable/cli_installation/">docs</a>.</p>
<h2 id="initialise-gitops-repo">Initialise GitOps repo</h2>
<p>This is a public repo. Ultimately, you will want to be using this as a private repo, but perhaps you will want to keep it connected to this public instance to be able to pull upstream changes. To achieve this, mirror this public repo into your own private repo.  </p>
<p>First, get a copy of this repo. The following assumes you want to take this template as a starting point to create a new repo (eg. your private GitOps repo), then make your own modifications, while still retaining the ability to pull updates from the template. <a href="https://stackoverflow.com/a/10966784">Reference SO</a>.</p>
<p>Create the private repo in gitlab. In whichever directory you store your projects:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># clone the template to your private repo</span>
git<span class="w"> </span>clone<span class="w"> </span>git@github.com:smp4/k3s-homelab-gitops.git<span class="w"> </span>k3s-homelab-gitops-private
<span class="nb">cd</span><span class="w"> </span>k3s-homelab-gitops-private

<span class="c1"># set the remote origin to your private repo on GitHub</span>
git<span class="w"> </span>remote<span class="w"> </span>set-url<span class="w"> </span>origin<span class="w"> </span>git@github.com:YOURUSERNAME/k3s-homelab-gitops-private.git

<span class="c1"># add the public template repo on GitHub as an upstream source</span>
git<span class="w"> </span>remote<span class="w"> </span>add<span class="w"> </span>upstream<span class="w"> </span>git@github.com:smp4/k3s-homelab-gitops.git
git<span class="w"> </span>remote<span class="w"> </span>-v<span class="w"> </span>show<span class="w">  </span><span class="c1"># verify</span>

<span class="c1"># push new repo to GitHub</span>
git<span class="w"> </span>push<span class="w"> </span>-u<span class="w"> </span>origin<span class="w"> </span>main

<span class="c1"># do work, commit, push to private repo</span>
git<span class="w"> </span>push<span class="w"> </span>origin<span class="w"> </span>main

<span class="c1"># pull updates from the public template</span>
git<span class="w"> </span>fetch<span class="w"> </span>upstream
git<span class="w"> </span>merge<span class="w"> </span>upstream/main
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This is not a fork. Create a fork if you want to contribute back to the public template.</p>
</div>
<h3 id="pulling-updates-from-public-repo">Pulling updates from public repo</h3>
<p>In your private repo, pull the updates from the public repo, then pull the latest refs from your private repo's remote, then push to your private repo's remote.</p>
<div class="highlight"><pre><span></span><code>git<span class="w"> </span>pull<span class="w"> </span>--no-rebase<span class="w"> </span>upstream<span class="w"> </span>main
git<span class="w"> </span>pull<span class="w"> </span>origin<span class="w"> </span>main
git<span class="w"> </span>push<span class="w"> </span>origin<span class="w"> </span>main
</code></pre></div>
<h2 id="install-ansible">Install Ansible</h2>
<p>Ansible is used for setup operations on the cluster node machines - OS level tasks.</p>
<p>For the most part, the repo does not use Ansible to do any templating of the Kubernetes resource yaml files. The idea is that Ansible is used only at bootstrap and then forgotten. An exception is some of the cluster infrastructure resources that are applied at bootstrap, including Kube VIP, where things like <code>apiserver_endpoint</code> are templated into the Kube VIP manifest.</p>
<p>Install Ansible in a Python virtual environment on the Ansible controller workstation (Ansible is a Python application).</p>
<p>Optionally use <code>direnv</code> to automatically load environment variables and activate the Python virtual environment whenever you <code>cd</code> into the repo directory.</p>
<p><a href="https://github.com/direnv/direnv/blob/master/docs/installation.md">Install <code>direnv</code></a>:</p>
<div class="highlight"><pre><span></span><code>curl<span class="w"> </span>-sfL<span class="w"> </span>https://direnv.net/install.sh<span class="w"> </span><span class="p">|</span><span class="w"> </span>bash
</code></pre></div>
<p>Add the following line to <code>~/.zshrc</code> (see the <code>direnv</code> docs for other shells):</p>
<div class="highlight"><pre><span></span><code><span class="nb">eval</span><span class="w"> </span><span class="s2">&quot;</span><span class="k">$(</span>direnv<span class="w"> </span>hook<span class="w"> </span>zsh<span class="k">)</span><span class="s2">&quot;</span>
</code></pre></div>
<p>Create <code>.envrc</code> file in the root directory of this repo and set up Python virtual environment, specifying <code>.venv</code> as the directory to store the virtual environment (so that it is easily recognised by IDE's), and explicitly selecting a Python version:</p>
<div class="highlight"><pre><span></span><code><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;export VIRTUAL_ENV=.venv&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>.envrc
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;layout python /usr/local/bin/python3.11&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>.envrc
direnv<span class="w"> </span>allow
which<span class="w"> </span>python3
which<span class="w"> </span>pip
pip<span class="w"> </span>install<span class="w"> </span>--upgrade<span class="w"> </span>pip
</code></pre></div>
<p>Otherwise, create the virtual environment using your preferred method.</p>
<p>With the virtual environment created, install requirements:</p>
<div class="highlight"><pre><span></span><code>pip<span class="w"> </span>install<span class="w"> </span>-r<span class="w"> </span>requirements.txt
</code></pre></div>
<p>If needed in development, use a <code>.env</code> file to define environment variables within the repo.</p>
<p>Install the required Ansible collections:</p>
<div class="highlight"><pre><span></span><code>ansible-galaxy<span class="w"> </span>install<span class="w"> </span>-r<span class="w"> </span>./ansible/collections/requirements.yml
</code></pre></div>
<h2 id="create-ansible-inventory-and-values-files">Create Ansible inventory and values files</h2>
<p>Next, configure your cluster site. If you are going to follow the tutorials and first deploy to your local host, you will need to populate the <code>ansible/inventory/localhost.yml</code> file. If you are only following the other tutorials, or deploying directly to a cluster of nodes, then you can ignore this file. All users will eventually need to populate the <code>ansible/inventory/hosts.yml</code> file.</p>
<p>Start with the defaults in the <code>samples/</code> directory:</p>
<div class="highlight"><pre><span></span><code>cp<span class="w"> </span>./samples/localhost-sample.yml<span class="w"> </span>./ansible/inventory/localhost.yml
cp<span class="w"> </span>./samples/hosts-sample.yml<span class="w"> </span>./ansible/inventory/hosts.yml
cp<span class="w"> </span>./samples/all-sample.yml<span class="w"> </span>./ansible/inventory/group_vars/all.yml
</code></pre></div>
<p>Edit <code>localhost.yml</code> and <code>all.yml</code> with the relevant values for your local machine. Descriptions for each variable are given in the sample files. The <code>localhost.yml</code>, make sure you list connection details for the local machine in the <code>servers</code> group only, and no machines in the <code>agent</code> group.</p>
<p>Update the host connection details in <code>hosts.yml</code> and cluster configuration variables in <code>all.yml</code> to suit your needs. You may need to modify the <code>all.yml</code> file when progressing to cluster deployment. </p>
<p>At this point, it might be useful to understand what each of the directories in the <a href="../repo-contents/">repo contents</a> are doing. </p>
<h2 id="generate-templated-manifests">Generate templated manifests</h2>
<p>Ansible is mostly used for bootstrapping the cluster nodes, however in a small number of cases it is mandatory to generate some kubernetes manifest (yaml) files from templates. This is just a hack to use Ansible to template and generate the KubeVIP and MetalLB manifests into the working directory of the GitOps repo on your local machine and only needs to be performed once prior to the first cluster deployment. </p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The following steps generating the KubeVIP templates and committing them to the repo <strong>must</strong> be completed before any deployments are made to the cluster, as KubeVIP creates the API endpoint IP address which both your local machine and all cluster nodes require to connect to and join the cluster.</p>
</div>
<p>Create the KubeVIP and MetalLB manifests from the Ansible templates with the Ansible playbook <code>generate-templates</code>. From the repo root directory:</p>
<div class="highlight"><pre><span></span><code>make<span class="w"> </span>manifest-templates
</code></pre></div>
<p>It does not matter which Ansible inventory file is used to execute the <code>generate-templates</code> play, as it will execute it on the local machine (the Ansible Controller) only, and once only. The contents of the values file <code>all.yml</code> are the main input. </p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The <code>make manifest-templates</code> command must be run from the root directory of this repo (the directory in which you found the <code>README.md</code> that you're currently reading). This directory is used to template and copy the kubeVIP manifests into the respective infrastructure workload directories in <code>./infrastructure</code>.</p>
</div>
<p>Commit the new files and push to the repository so that ArgoCD can reconcile them into the cluster later.</p>
<div class="highlight"><pre><span></span><code>git<span class="w"> </span>status
git<span class="w"> </span>add<span class="w"> </span>.
git<span class="w"> </span>commit<span class="w"> </span>-m<span class="w"> </span><span class="s2">&quot;Add KubeVIP manifests.&quot;</span>
git<span class="w"> </span>push<span class="w">  </span><span class="c1"># Assuming the repo is already set up to push to remote origin.</span>
</code></pre></div>
<h2 id="create-local-bootstrap-secrets">Create local bootstrap secrets</h2>
<p>These secrets are used by Ansible to bootstrap the node machines. Encrypted secrets are implemented as variables (rather than files).</p>
<p>Bootstrap secrets (host <code>ansible_become_pass</code>, <code>k3s_token</code> ) are stored in Ansible Vault. Ansible Vault comes as part of the Ansible installation. The user must create these secrets locally, and store them locally. They are never used again once the cluster is initialised. The encrypted secrets are provided to Ansible via <code>ansible/inventory/group_vars/all.yml</code> and <code>ansible/inventory/hosts.yml</code> (or <code>localhost.yml</code>). These files, with their secrets, are listed in <code>.gitignore</code>, so are never committed to version control. </p>
<p>Production-time secrets will be separately encrypted and stored using Sealed Secrets.</p>
<p>The user must create the bootstrap encrypted secrets first, before running any Ansible playbooks. The scripts are currently configured assuming all secrets belong to a <code>vault-id</code> called <code>home</code>, encrypted with a single password.</p>
<p>Create the secrets at the prompts triggered by each of the following commands. <strong>Don't</strong> hit <code>enter</code> after entering the password: use <code>ctrl-d</code> per the instructions that Ansible will print to screen. Use the same vault password for each command (you can use different passwords if you want, but then the <code>make</code> commands in future steps won't work out of hte box).</p>
<p>To encrypt a password to elevate <code>ansible_user</code> privileges on a host, run and paste the output of the following for the respective host in <code>hosts.yml</code>:</p>
<div class="highlight"><pre><span></span><code>ansible-vault<span class="w"> </span>encrypt_string<span class="w"> </span>--vault-id<span class="w"> </span>home@prompt<span class="w"> </span>--stdin-name<span class="w"> </span><span class="s2">&quot;ansible_become_pass&quot;</span>
</code></pre></div>
<p>To encrypt the <code>vault_k3s_token</code> variable in <code>all.yml</code>:</p>
<div class="highlight"><pre><span></span><code>ansible-vault<span class="w"> </span>encrypt_string<span class="w"> </span>--vault-id<span class="w"> </span>home@prompt<span class="w"> </span>--stdin-name<span class="w"> </span><span class="s2">&quot;k3s_token&quot;</span>
</code></pre></div>
<p>The above secrets need to be generated for each node.</p>
<p>For convenience, save your vault password in plain text in a file called <code>vault_pass</code> in the root directory of this repo. Make sure this filename is in your <code>.gitignore</code> so that it doesn't get tracked by Git. </p>
<div class="highlight"><pre><span></span><code><span class="c1"># example vault_pass file</span>
your-password-here-in-plain-text
</code></pre></div>
<p>Some of the Ansible-related <code>make</code> commands used throughout the tutorials will call this password automatically to decrypt your secrets. If you don't want to store your password like this, you will need to manually edit the <code>Makefile</code> yourself. Other commands will prompt the user for the password of the <code>home</code> vault. Use these as an example for your changes.</p>
<p>Now <code>kubectl</code> can be used without having to use <code>sudo</code> or manually specify the cluster config location.</p>
<p>From here, if you know what you are doing you can provision and deploy the cluster directly to production. To take an incremental approach, checking that everything works at each step, deploy in stages following the <a href="../../tutorials/">Tutorials</a>.</p>
<h2 id="customise-the-cluster-configuration">Customise the cluster configuration</h2>
<p>Manually edit the following <code>*.yaml</code> files to suit your preferences.</p>
<table>
<thead>
<tr>
<th>File</th>
<th>Key</th>
<th>Value</th>
<th>Comment</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>bootstrap/base/ingress-argo.yaml</code></td>
<td><code>spec.routes.match:</code></td>
<td><code>Host('argocd.your.domain.com')</code></td>
<td>URL for ArgoCD UI</td>
</tr>
<tr>
<td><code>components/envs/prod/patch-appproj-dev1-sourceRepos.yaml</code></td>
<td><code>spec.sourceRepos:</code></td>
<td>Private Gitops Repo URL (ssh)</td>
<td></td>
</tr>
<tr>
<td><code>components/envs/prod/patch-appset-infrastructure-generators.yaml</code></td>
<td><code>spec.generators.git.repoURL:</code></td>
<td>Private Gitops Repo URL (ssh)</td>
<td></td>
</tr>
<tr>
<td><code>components/envs/prod/patch-appset-infrastructure-source.yaml</code></td>
<td><code>spec.template.spec.source.repoURL:</code></td>
<td>Private Gitops Repo URL (ssh)</td>
<td></td>
</tr>
<tr>
<td><code>components/envs/prod/patch-appset-tenants-generators.yaml</code></td>
<td><code>spec.generators.git.repoURL:</code></td>
<td>Private Gitops Repo URL (ssh)</td>
<td></td>
</tr>
<tr>
<td><code>components/envs/prod/patch-appset-tenants-source.yaml</code></td>
<td><code>spec.template.spec.source.repoURL</code></td>
<td>Private Gitops Repo URL (ssh)</td>
<td></td>
</tr>
<tr>
<td><code>infrastructure/cert-manager/base/issuer-letsencrypt-prod.yaml</code></td>
<td><code>spec.acme.email</code>, <code>spec.acme.solvers.dns01.cloudflare.email</code></td>
<td>Your DNS service email address (eg Cloudflare)</td>
<td></td>
</tr>
<tr>
<td><code>infrastructure/cert-manager/base/issuer-letsencrypt-prod.yaml</code></td>
<td><code>spec.solvers.selector.dnsZones</code></td>
<td>Your DNS zone URL</td>
<td></td>
</tr>
<tr>
<td><code>infrastructure/cert-manager/base/issuer-letsencrypt-stage.yaml</code></td>
<td>per prod</td>
<td>per prod</td>
<td></td>
</tr>
<tr>
<td><code>infrastructure/longhorn/base/ingressRoute-dashboard.yaml</code></td>
<td><code>spec.routes.match:</code></td>
<td><code>Host('longhorn.your.domain.com')</code></td>
<td>URL for longhorn UI</td>
</tr>
<tr>
<td><code>infrastructure/longhorn/base/setting-buTarget.yaml</code></td>
<td><code>value:</code></td>
<td><code>nfs://192.168.0.1:/path/to/your/nfs/backup/target</code></td>
<td>Same directory as set in Ansible <code>all.yml</code> values file for <code>longhorn_nfs_backup_target</code></td>
</tr>
<tr>
<td><code>infrastructure/traefik/base/ingress-dashboard.yaml</code></td>
<td><code>spec.routes.match:</code></td>
<td>Host('traefik.your.domain.com')`</td>
<td>URL for Traefik UI</td>
</tr>
<tr>
<td><code>infrastructure/traefik/base/values-traefik.yaml</code></td>
<td><code>loadBalncerIP:</code></td>
<td>Any IP in the MetalLB range</td>
<td></td>
</tr>
<tr>
<td><code>infrastructure/traefik/envs/dev/cert-selfsigned.yaml</code></td>
<td><code>spec.commonName:</code>, <code>spec.dnsNames:</code></td>
<td><code>traefik.your.domain.com</code></td>
<td>URL for Traefik UI</td>
</tr>
<tr>
<td><code>infrastructure/traefik/envs/prod/cert-wildcard-prod.yaml</code></td>
<td><code>spec.dnsNames:</code>, <code>spec.commonName</code></td>
<td><code>your.domain.come</code></td>
<td>Your root domain URL</td>
</tr>
<tr>
<td><code>infrastructure/traefik/envs/stage/cert-wildcard-prod.yaml</code></td>
<td><code>spec.dnsNames:</code>, <code>spec.commonName</code></td>
<td><code>your.domain.come</code></td>
<td>Your root domain URL</td>
</tr>
<tr>
<td><code>tenants/test-ingress/base/whoami.yaml</code></td>
<td>In IngressRoute <code>spec.routes.match:</code></td>
<td><code>Host('test.your.domain.com)</code></td>
<td>URL for ingress test tenant workload</td>
</tr>
<tr>
<td><code>tenants/test-lb/base/service.yaml</code></td>
<td><code>metadata.annotations.metallb.universe.tf/loadBalancerIPs:</code></td>
<td>IP address</td>
<td>IP Address from your MetalLB pool</td>
</tr>
</tbody>
</table>
<p>For instructions on which values to use, see the <code>README.md</code> files in each of the workload directories.</p>
<h2 id="helm-charts">Helm Charts</h2>
<p>Several of the infrastructure workloads are installed from Helm Charts. Go through each of the infrastructure workload directories, read their <code>README.md</code> files and follow their installation instructions.</p>


<!-- taken from 
https://github.com/squidfunk/mkdocs-material/blob/master/src/partials/source-file.html -->

<hr />
<div class="md-source-file">
<small>

    <!-- mkdocs-git-revision-date-localized-plugin -->
    
    Last update:
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-datetime">June 13, 2024 16:06:52</span>
    
        <br />
        Created:
        <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-datetime">June 13, 2024 16:06:52</span>
    

    <!-- mkdocs-git-revision-date-plugin -->
    
</small>
</div>




                

  
    <div class="md-source-date">
      <small>
          Authors: <span class='git-page-authors git-authors'><a href='mailto:51273275+smp4@users.noreply.github.com'>smp4</a></span>
      </small>
    </div>
  

              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../" class="md-footer__link md-footer__link--prev" aria-label="Previous: Getting Started">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Getting Started
              </div>
            </div>
          </a>
        
        
          
          <a href="../repo-contents/" class="md-footer__link md-footer__link--next" aria-label="Next: Repository Contents">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Repository Contents
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.instant", "navigation.tracking", "navigation.path", "navigation.tabs", "navigation.tabs.sticky", "navigation.expand", "navigation.top", "navigation.footer", "navigation.indexes", "toc.follow", "search.suggest", "search.highlight", "search.share", "content.code.copy", "content.action.edit", "content.action.view"], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.ad660dcc.min.js"></script>
      
    
  <script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></body>
</html>